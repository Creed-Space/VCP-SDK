import{d as m,w as h,g as _}from"./CYrRvoOV.js";const S="vcp_audit_trail";function y(){return typeof window<"u"&&typeof localStorage<"u"}function C(){if(!y())return[];try{const e=localStorage.getItem(S);return e?JSON.parse(e):[]}catch{return[]}}function g(e){if(y())try{const t=e.slice(-100);localStorage.setItem(S,JSON.stringify(t))}catch{console.warn("Failed to save audit trail to localStorage")}}function T(){const e=C(),{subscribe:t,set:n,update:a}=h(e);return{subscribe:t,set:r=>{n(r),g(r)},update:a,clear:()=>{n([]),g([])},getByPlatform:r=>_({subscribe:t}).filter(i=>i.platform_id===r),getByEventType:r=>_({subscribe:t}).filter(i=>i.event_type===r),getToday:()=>{const r=_({subscribe:t}),o=new Date().toISOString().split("T")[0];return r.filter(i=>i.timestamp.startsWith(o))}}}const v=T();function p(e){v.update(t=>{const n=[...t,e];return g(n),n})}function I(e,t,n,a){const r={id:`share-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),event_type:"context_shared",platform_id:e,data_shared:t,data_withheld:n,private_fields_influenced:a,private_fields_exposed:0};return p(r),r}function x(e,t,n,a){const r={id:`rec-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),event_type:"recommendation_generated",platform_id:e,data_shared:t,data_withheld:n,private_fields_influenced:n.length>0?1:0,private_fields_exposed:0,details:a};return p(r),r}function k(e,t,n){const a={id:`adj-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),event_type:"adjustment_recorded",platform_id:e,data_shared:["adjustment_count","adjustment_date"],data_withheld:Object.keys(n),private_fields_influenced:1,private_fields_exposed:0,details:{public_summary:t,_private:n}};return p(a),a}const N=m(v,e=>{const t=new Date().toISOString().split("T")[0];return e.filter(n=>n.timestamp.startsWith(t))});m(v,e=>{const t=new Set(e.map(n=>n.platform_id).filter(Boolean));return Array.from(t)});function j(e,t){return e.map(n=>{var r,o,i,s,d;const a={timestamp:n.timestamp,event_type:n.event_type,private_context_used:(n.private_fields_influenced??0)>0,private_context_exposed:!1};switch(t){case"hr":a.compliance_status={policy_followed:!0,budget_compliant:((r=n.details)==null?void 0:r.budget_compliant)??!0,mandatory_addressed:((o=n.details)==null?void 0:o.mandatory_addressed)??!0};break;case"manager":a.compliance_status={policy_followed:!0,budget_compliant:((i=n.details)==null?void 0:i.budget_compliant)??!0};break;case"community":a.progress_summary=(s=n.details)==null?void 0:s.progress_summary;break;case"coach":a.progress_summary=(d=n.details)==null?void 0:d.progress_summary;break}return a})}function B(e){var s,d;const t={},n=new Set;let a=0,r=0,o=0,i=0;for(const l of e)t[l.event_type]=(t[l.event_type]||0)+1,l.platform_id&&n.add(l.platform_id),a+=((s=l.data_shared)==null?void 0:s.length)||0,r+=((d=l.data_withheld)==null?void 0:d.length)||0,o+=l.private_fields_influenced||0,i+=l.private_fields_exposed||0;return{totalEvents:e.length,eventsByType:t,platformsAccessed:Array.from(n),fieldsSharedCount:a,fieldsWithheldCount:r,privateInfluencedCount:o,privateExposedCount:i}}const u="vcp_context",f="vcp_consents";function b(){return typeof window<"u"&&typeof localStorage<"u"}function w(e){if(!b())return null;try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return console.warn(`Failed to load ${e} from localStorage`),null}}function c(e,t){if(b())try{t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}catch{console.warn(`Failed to save ${e} to localStorage`)}}function A(){const e=w(u),{subscribe:t,set:n,update:a}=h(e);return{subscribe:t,set:r=>{n(r),c(u,r)},update:r=>{a(o=>{const i=r(o);return c(u,i),i})},clear:()=>{n(null),c(u,null)},updateField:(r,o)=>{a(i=>{if(!i)return i;const s={...i,[r]:o,updated:new Date().toISOString()};return c(u,s),s})}}}const O=A();m(O,e=>{var t,n,a,r,o,i,s,d,l;return e?{display_name:(t=e.public_profile)==null?void 0:t.display_name,goal:(n=e.public_profile)==null?void 0:n.goal,experience:(a=e.public_profile)==null?void 0:a.experience,learning_style:(r=e.public_profile)==null?void 0:r.learning_style,pace:(o=e.public_profile)==null?void 0:o.pace,motivation:(i=e.public_profile)==null?void 0:i.motivation,role:(s=e.public_profile)==null?void 0:s.role,team:(d=e.public_profile)==null?void 0:d.team,career_goal:(l=e.public_profile)==null?void 0:l.career_goal}:null});m(O,e=>{if(!e)return null;const t=e.private_context||{},n=e.constraints||{};return{time_limited:n.time_limited??!!t.schedule_irregular,budget_limited:n.budget_limited??!!t.financial_constraint,noise_restricted:n.noise_restricted??!!t.noise_sensitive,energy_variable:n.energy_variable??!!t.energy_variable,schedule_irregular:n.schedule_irregular??!!t.schedule_irregular,mobility_limited:n.mobility_limited??!!t.mobility_limited,health_considerations:n.health_considerations??!!t.health_conditions}});function D(){const e=w(f)||{},{subscribe:t,set:n,update:a}=h(e);return{subscribe:t,set:n,update:a,grantConsent:(r,o,i)=>{const s={platform_id:r,granted_at:new Date().toISOString(),required_fields:o,optional_fields:i};return a(d=>{const l={...d,[r]:s};return c(f,l),l}),p({id:`consent-${Date.now()}`,timestamp:new Date().toISOString(),event_type:"consent_granted",platform_id:r,data_shared:[...o,...i],data_withheld:[],private_fields_influenced:0,private_fields_exposed:0}),s},revokeConsent:r=>{a(o=>{const{[r]:i,...s}=o;return c(f,s),s}),p({id:`consent-revoke-${Date.now()}`,timestamp:new Date().toISOString(),event_type:"consent_revoked",platform_id:r,data_shared:[],data_withheld:[],private_fields_influenced:0,private_fields_exposed:0})},hasConsent:r=>!!_({subscribe:t})[r],getConsent:r=>_({subscribe:t})[r]||null}}const F=D();export{F as a,k as b,j as c,x as d,B as g,I as l,N as t,O as v};
